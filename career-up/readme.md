# 시나리오

4가지 주요 기능

- SNS 처럼 서로 의견을 작성하여 공유하는 기능 -> 포스팅
- 여러 사용자들이 친구를 맺고, 관계를 확장하는 기능 -> 인맥
- 개발자들에게 필요한 여러가지 교육 컨텐츠를 보여주는 기능 -> 교육
- 회사에서 채용 공고를 보여주고 지원할 수 있는 기능 -> 채용 공고
- 계정 기능

# 규모가 큰 모놀리스 프론트엔드 시스템에서 나타나는 전조 증상

- 코드를 수정한 후, 엉뚱한 곳에서 버그가 발생한다.
- 새로운 기능을 위해 기존 코드를 활용하기 무섭다.
- 간단한 수정사항을 적용하기 위해 통합, 테스트, 빌드 및 배포 시간이 점점 길어진다.
- 작업을 위한 커뮤니케이션이 점점 늘어난다.
- 동일한 기능을 제공하기 위해 여기 저기서 각각 개발하는 일이 늘어난다.

# Application Shell과 Routing 패키지

- 외부에서 보여지는 브라우저 라우터와 내부에서 관리되는 메모리 라우터를 적절히 혼합하는 방법을 사용
- Shell이란 앱을 만들고 실제 앱을 구동하는 메인의 역할을 한다.
- 가장 중요한 역할로는 브라우저의 경로를 Shel이 받아서 마이크로 앱으로 적절히 전달한다.
- 마이크로 앱은 메모리 라우터를 사용하며, 이 메모리 라우터의 변경과 Shell은 브라우저의 커스텀 이벤트로 통신하며 적절한 로직으로 처리
- 비슷한 로직이 Shell과 여러 마이크로 앱에 중복으로 사용되므로, 이 로직을 추상화하여 shell-router라는 패키지로 옮긴다.
  - 전반적으로 사용되는 패키지므로 패키지가 수정되면 전체 앱을 재배포해야 한다.

# 로그인과 토큰 공유

- 회원가입, 로그인, 로그아웃, 비번 찾기 등 계정과 관련된 기능은 Auth0를 사용
- 로그인 정보는 앱의 Shell에서 관리
- 마이크로 앱은 별도의 리액트 앱이 실행되고 있으므로, 인증과 관련된 데이터(토큰, 유저 정보)를 이벤트를 통해 Shell에서 가져온다.
- Shell과 마이크로 앱의 통신하는 로직을 위해 별도의 패키지로 만들고 이를 마이크로 앱에서 활용하도록 구현

# 스타일 격리

- 같은 문서 내에서 스타일을 격리하는 것은 기술적으로 불가능 (Shadow DOM만 가능)
- class 이름을 다루는 기준을 명확히 나누고 해당 가이드를 따르도록 해야 한다.
- 가이드를 벗어나지 않는 선에서는 각자의 마이크로 앱이 각자의 css 라이브러리를 사용해도 된다.
- Ui kit 패키지에서 공유되는 컴포넌트들은 특정 기술에 의존적이지 않도록 기본적인 기술로만 작성

# 서비스를 나누는 기준 수립

- 기존 서비스가 있는 경우
  - 모든 페이지들을 나열하여 유형을 분류하고 유형별로 팀을 나눠 적당한 팀에게 오너십을 준다.
  - 한 페이지에 목적이 여러가지가 있는 경우는 조각으로 잘라내서 맞는 팀에게 나누어 준다.
- 고객의 요구사항 중심으로 팀을 구성하고 페이지와 조각을 분류하여 팀에게 오너십을 준다.
  - 고객의 요구사항을 명확하게 팀으로 만들지 못하면 누락이 발생할 수 있다.
- 도메인 주도 설계의 도메인 논리와 바운디드 컨텍스트를 이용해서 팀의 경계를 설정한다.

# 프로젝트 구조

### 앱(런타임 결합) - webpack, rspack

- shell (auth0)
- posting
- network
- edu
- job

### 패키지(빌드 타임 결합) - vite(쉽게 패키지화하기 위해서)

- ui-kit
- shell-router
- ...

# shell-router의 인터페이스

## 라우팅

- hooks
  - useAppEvent
    - 마이크로 앱에서 shell의 라우팅 이동에 관한 이벤트를 받아 마이크로 앱의 라우팅을 처리
    - 마이크로 앱의 라우팅이 변한 경우 shell에게 이벤트를 전송
  - useShellEvent
    - 마이크로 앱의 라우팅 이동에 관한 이벤트를 받아 shell의 라우팅을 처리
    - Shell의 라우팅이 변한 경우 마이크로 앱에서 이벤트를 전송
- components
  - AppRoutingManager
    - useAppEvent를 사용하여 Outlet으로 연결하는 컴포넌트
- mount 함수
  - injectFactory
    - 각 마이크로 앱을 shell에게 연결할 수 있도록 만들어주는 팩토리 함수

## 인증

- hooks
  - useAuthEvent
    - 로그인한 유저 정보를 얻기 위해 요청을 받고 이벤트로 유저 정보를 돌려주는 훅
  - getUserAsync
    - 유저 정보를 요청하고 이벤트를 받을 때까지 기다렸다가 받아서 리턴하는 프로미스 함수

